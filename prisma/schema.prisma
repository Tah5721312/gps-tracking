generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ­ ENUMS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

enum VehicleStatus {
  moving // ØªØªØ­Ø±Ùƒ
  stopped // Ù…ØªÙˆÙ‚ÙØ© (Ø§Ù„Ù…Ø­Ø±Ùƒ Ø´ØºØ§Ù„)
  turnoff // Ù…Ø·ÙÙŠØ© (Ø§Ù„Ù…Ø­Ø±Ùƒ Ù…Ø·ÙÙŠ)
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸšš MODEL: Vehicle - Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model Vehicle {
  id          Int    @id @default(autoincrement())
  name        String // Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ¨Ø© (Ù…Ø«Ù„: Ø³ÙŠØ§Ø±Ø© 1)
  plateNumber String @unique // Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©
  deviceImei  String @unique // IMEI Ø¬Ù‡Ø§Ø² GPS

  // Ø±Ø¨Ø· Ø§Ù„Ø³Ø§Ø¦Ù‚
  driverId Int? // Ù…Ø¹Ø±Ù Ø§Ù„Ø³Ø§Ø¦Ù‚
  driver   Driver? @relation(fields: [driverId], references: [id], onDelete: SetNull)

  // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  status VehicleStatus @default(turnoff)

  // Ø¢Ø®Ø± Ù…ÙˆÙ‚Ø¹ Ù…Ø¹Ø±ÙˆÙ
  lastLatitude  Float?
  lastLongitude Float?
  lastSpeed     Float? // ÙƒÙ…/Ø³
  lastUpdate    DateTime? // Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù…Ù† GPS

  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆÙ‚Ù
  stoppedAt        DateTime? // ÙˆÙ‚Øª Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆÙ‚Ù Ø§Ù„Ø­Ø§Ù„ÙŠ
  totalStoppedTime Int       @default(0) // Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙˆÙ‚Øª Ø§Ù„ÙˆÙ‚ÙˆÙ Ø§Ù„ÙŠÙˆÙ… (Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ)

  // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙŠÙˆÙ…ÙŠØ© (ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†Ù‡Ø§ ÙƒÙ„ ÙŠÙˆÙ…)
  dailyDistance  Float     @default(0) // Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (ÙƒÙ…)
  dailyMaxSpeed  Float     @default(0) // Ø£Ù‚ØµÙ‰ Ø³Ø±Ø¹Ø© Ø§Ù„ÙŠÙˆÙ… (ÙƒÙ…/Ø³)
  dailyStartTime DateTime? // ÙˆÙ‚Øª Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙŠÙˆÙ…
  dailyStops     Int       @default(0) // Ø¹Ø¯Ø¯ Ø§Ù„ØªÙˆÙ‚ÙØ§Øª Ø§Ù„ÙŠÙˆÙ…
  lastResetDate  DateTime? @default(now()) // Ø¢Ø®Ø± reset Ù„Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  trackingPoints TrackingPoint[]
  dailyReports   DailyReport[]

  @@index([status])
  @@index([lastUpdate])
  @@index([driverId])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ‘¤ MODEL: Driver - Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model Driver {
  id         Int       @id @default(autoincrement())
  name       String // Ø§Ù„Ø§Ø³Ù… (Ù…Ø·Ù„ÙˆØ¨)
  phone      String    @unique // Ø±Ù‚Ù… Ø§Ù„ØªÙ„ÙŠÙÙˆÙ† (Ù…Ø·Ù„ÙˆØ¨)
  address    String // Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ù…Ø·Ù„ÙˆØ¨)
  nationalId String?   @unique // Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ
  province   String? // Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©
  birthDate  DateTime? @db.Date // ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯
  notes      String?   @db.Text // Ù…Ù„Ø§Ø­Ø¸Ø§Øª

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª
  vehicles Vehicle[] // Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø³Ø§Ø¦Ù‚

  @@index([name])
  @@index([phone])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“ MODEL: TrackingPoint - Ù†Ù‚Ø§Ø· Ø§Ù„ØªØªØ¨Ø¹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model TrackingPoint {
  id        Int     @id @default(autoincrement())
  vehicleId Int
  vehicle   Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
  latitude  Float
  longitude Float
  speed     Float // ÙƒÙ…/Ø³
  heading   Float? // Ø§Ù„Ø§ØªØ¬Ø§Ù‡ (0-360)

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ù† GPS
  batteryLevel Int? // Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©
  gpsAccuracy  Float? // Ø¯Ù‚Ø© GPS (Ø¨Ø§Ù„Ø£Ù…ØªØ§Ø±)
  altitude     Float? // Ø§Ù„Ø§Ø±ØªÙØ§Ø¹

  timestamp DateTime // ÙˆÙ‚Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…Ù† GPS
  createdAt DateTime @default(now()) // ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

  @@index([vehicleId, timestamp(sort: Desc)])
  @@index([timestamp(sort: Desc)])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š MODEL: DailyReport - Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model DailyReport {
  id        Int     @id @default(autoincrement())
  vehicleId Int
  vehicle   Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  date DateTime @db.Date // Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø¨Ø¯ÙˆÙ† ÙˆÙ‚Øª)

  // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø­Ù„Ø©
  totalDistance    Float @default(0) // Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ© (ÙƒÙ…)
  totalDuration    Int   @default(0) // Ù…Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„ (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)
  totalStoppedTime Int   @default(0) // ÙˆÙ‚Øª Ø§Ù„ØªÙˆÙ‚Ù Ø§Ù„ÙƒÙ„ÙŠ (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)
  totalMovingTime  Int   @default(0) // ÙˆÙ‚Øª Ø§Ù„Ø­Ø±ÙƒØ© (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)

  // Ø§Ù„Ø³Ø±Ø¹Ø§Øª
  maxSpeed Float @default(0) // Ø£Ù‚ØµÙ‰ Ø³Ø±Ø¹Ø© (ÙƒÙ…/Ø³)
  avgSpeed Float @default(0) // Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø±Ø¹Ø© (ÙƒÙ…/Ø³)

  // Ø§Ù„ØªÙˆÙ‚ÙØ§Øª
  numberOfStops Int @default(0) // Ø¹Ø¯Ø¯ Ø§Ù„ØªÙˆÙ‚ÙØ§Øª
  longestStop   Int @default(0) // Ø£Ø·ÙˆÙ„ ØªÙˆÙ‚Ù (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)

  // Ø§Ù„Ø£ÙˆÙ‚Ø§Øª
  firstMovement DateTime? // Ø£ÙˆÙ„ Ø­Ø±ÙƒØ© ÙÙŠ Ø§Ù„ÙŠÙˆÙ…
  lastMovement  DateTime? // Ø¢Ø®Ø± Ø­Ø±ÙƒØ© ÙÙŠ Ø§Ù„ÙŠÙˆÙ…

  // Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©
  startLat Float?
  startLng Float?
  endLat   Float?
  endLng   Float?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([vehicleId, date])
  @@index([date(sort: Desc)])
  @@index([vehicleId, date(sort: Desc)])
  @@index([vehicleId])
  @@index([firstMovement])
  @@index([lastMovement])
  @@index([date, firstMovement, lastMovement])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸš¨ MODEL: Alert - Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

model Alert {
  id        Int      @id @default(autoincrement())
  vehicleId Int
  type      String // speeding, stopped_too_long, engine_off, geofence
  severity  String // low, medium, high
  message   String
  latitude  Float?
  longitude Float?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([vehicleId, isRead])
  @@index([createdAt(sort: Desc)])
}
